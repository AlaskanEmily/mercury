#-----------------------------------------------------------------------------#

THIS_DIR = benchmarks

# uncomment the following line to test the performance
# of the benchmarks (with I/O suppressed)
# MLFLAGS=-w "`extract $(*:_init=) '' BenchEntry`"

#-----------------------------------------------------------------------------#

PROGS=	\
	cqueens \
	crypt \
	deriv \
	deriv2 \
	nrev \
	poly \
	primes \
	qsort \
	queens \
	query \
	tak

TESTS=$(PROGS)
SUBDIRS=
TESTS_DIR=..
include $(TESTS_DIR)/Mmake.common

# Module-specific options should go in Mercury.options so they
# can be found by `mmc --make'.
include Mercury.options

#-----------------------------------------------------------------------------#

%.runtest: %.res ;

SS=	$(PROGS:%=%.s)
CS=	$(PROGS:%=%.c)
TIMES=	$(PROGS:%=%.time)

cs:	$(CS)

ss:	$(SS)

times:	$(TIMES)

dir.%:	$(PROGS) $(SS)
	-mkdir $@
	cp $(PROGS) $(SS) $@
	cp BenchEntry $@

%.time: %
	{ count=`awk '/$*/ { print $$2; exit; }' < BenchRepeatCounts`; \
	echo "$$count	"; \
	MERCURY_OPTIONS="-t -r$$count" ./repeat_time 3 ./$*; } 2>&1 | tee $@

#-----------------------------------------------------------------------------#
