#-----------------------------------------------------------------------------#

THIS_DIR = mmc_make

#-----------------------------------------------------------------------------#

# Any program added here should also be added to the `.cvsignore' file.

MMAKE_USE_MMC_MAKE=yes

PROGS =	\
		complex_test \
		hello \
		rebuild

# These tests only work if the workspace was compiled with `--use-subdirs'.
ifneq ($(origin WORKSPACE),undefined)
    ifeq ($(shell [ -d $(WORKSPACE)/library/Mercury ] || echo cannot_run),cannot_run)
	PROGS =
    endif
endif

SUBDIRS=
TESTS=$(PROGS)
TESTS_DIR=..
include $(TESTS_DIR)/Mmake.common

%.runtest: %.res ;

complex_test.log: install_libs

# Just test that the executable is rebuilt.
rebuild.runtest:
	$(MCM) --rebuild rebuild
	$(MCM) --rebuild --verbose-make rebuild > rebuild.err2 2>&1
	grep '^Making rebuild$(EXT_FOR_EXE)$$' rebuild.err2

.PHONY: install_libs
install_libs: start_runtests_local
	cd lib; \
	$(MCM) --no-libgrade --install-prefix $(shell pwd)/install \
			libcomplex_numbers.install

realclean_local:
	rm -rf install rebuild.err2
	cd lib; $(MCM) complex_numbers.realclean

#-----------------------------------------------------------------------------#
