#-----------------------------------------------------------------------------#

main_target: check

include ../Mmake.common

#-----------------------------------------------------------------------------#

ifeq ($(HAVE_NUPROLOG),yes)
%.exp: %.nu
	{ [ -f $*.inp ] && cat $*.inp; } | ./$< > $@ 2>&1;
endif

#-----------------------------------------------------------------------------#

NONDETPROGS=	commit_bug \
		commit_bug_2 \
		disj_disj \
		dnf \
		hello_again \
		interpreter \
		nasty_nondet \
		nondet_disj \
		nondet_ite \
		nondet_ite_2 \
		nondet_ite_3 \
		nondetlive \
		partition \
		semidet_lambda

DETPROGS=	arithmetic \
		det_complicated_unify \
		double_error \
		double_error2 \
		duplicate_label \
		environment \
		fail_detism \
		float_test \
		frameopt_mkframe_bug \
		higher_order \
		liveness \
		liveness2 \
		mode_inf_bug \
		mu \
		parse_list \
		petdr1 \
		semidet_map \
		set_test \
		string__format_test \
		string_test \
		string_test_2 \
		univ \
		unreachable

NOTWORKING=

#
# The nondet tests use solutions/2, which is currently implemented only for GC
# grades.  So only include those tests if the grade is a GC grade.
#

ifeq ("$(findstring .gc, $(GRADE))","")
PROGS=$(DETPROGS)
else
PROGS=$(DETPROGS) $(NONDETPROGS)
endif

# mode_inf_bug needs to be compiled with `--infer-all'.
MCFLAGS-mode_inf_bug = --infer-all

DEPENDS=$(PROGS:%=%.depend)
OUTS=	$(PROGS:%=%.out)
EXPS=	$(PROGS:%=%.exp)
RESS=	$(PROGS:%=%.res)
MODS=	$(PROGS:%=%.mod)

depend: $(DEPENDS)

exp:	$(EXPS)

check:	$(OUTS) $(RESS)

mods:	$(MODS)

all:	$(PROGS)

clean:
	rm -f *.c *.o *.err2 *.d *.dep *.nu *.nu.save

#-----------------------------------------------------------------------------#
