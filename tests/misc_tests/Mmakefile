#-----------------------------------------------------------------------------#

main_target: check

include ../Mmake.common

#-----------------------------------------------------------------------------#

mdemangle_test.out: mdemangle_test.inp
	mdemangle < mdemangle_test.inp > mdemangle_test.out 2>&1

debugger_regs.out: debugger_regs debugger_regs.inp
	./debugger_regs debugger_regs.m < debugger_regs.inp \
		> debugger_regs.out 2>&1

debugger_test.out: debugger_test debugger_test.inp
	./debugger_test debugger_test.m < debugger_test.inp \
		> debugger_test.out 2>&1

pretty_print_test.out: pretty_print_test.ugly
	cp pretty_print_test.ugly pretty_print_test.out

#-----------------------------------------------------------------------------#

STACK_LAYOUT_PROGS=	\
	debugger_regs	\
	debugger_test

OTHER_PROGS =

OTHER_TESTS = mdemangle_test pretty_print_test

MCFLAGS-debugger_regs = --generate-trace
MCFLAGS-debugger_test = --generate-trace

# Not all grades can be used with stack layouts
#
ifeq ($(GRADE),jump) 
	PROGS=$(OTHER_PROGS)
else
	ifeq ($(GRADE),fast)
		PROGS=$(OTHER_PROGS)
	else
		PROGS=$(STACK_LAYOUT_PROGS) $(OTHER_PROGS)
	endif
endif

#-----------------------------------------------------------------------------#

DEPS=	$(PROGS:%=%.dep)
DEPENDS=$(PROGS:%=%.depend)
OUTS=	$(PROGS:%=%.out) $(OTHER_TESTS:%=%.out)
RESS=	$(PROGS:%=%.res) $(OTHER_TESTS:%=%.res)
MODS=	$(PROGS:%=%.mod)

#-----------------------------------------------------------------------------#

dep:	$(DEPS)

depend:	$(DEPENDS)

check:	$(OUTS) $(RESS)

mods:	$(MODS)

all:	$(PROGS)

#-----------------------------------------------------------------------------#
