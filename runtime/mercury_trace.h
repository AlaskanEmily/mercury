/*
** Copyright (C) 1997-1998 The University of Melbourne.
** This file may only be copied under the terms of the GNU Library General
** Public License - see the file COPYING.LIB in the Mercury distribution.
*/

/*
** mercury_trace.h - defines the interface between
** the tracing subsystem and compiled code.
**
** The macros and functions defined in this module are intended to be called
** only from code generated by the Mercury compiler, and from hand-written
** code in the Mercury runtime or the Mercury standard library.
*/

#ifndef MERCURY_TRACE_H
#define MERCURY_TRACE_H

#define	MR_trace_incr_seq()	(++MR_trace_call_seqno)
#define	MR_trace_incr_depth()	(++MR_trace_call_depth)
#define	MR_trace_reset_depth(d)	do { MR_trace_call_depth = (d); } while (0)

extern	int	MR_trace_call_seqno;
extern	int	MR_trace_call_depth;

/*
** This enum should exactly match the definition of the `trace_port' type in
** library/debugger_interface.
*/

typedef	enum {
	MR_PORT_CALL,
	MR_PORT_EXIT,
	MR_PORT_FAIL,
	MR_PORT_THEN,
	MR_PORT_ELSE,
	MR_PORT_DISJ,
	MR_PORT_SWITCH,
	MR_PORT_PRAGMA_FIRST,
	MR_PORT_PRAGMA_LATER
} MR_trace_port;

extern	void	MR_trace(
	const MR_Stack_Layout_Label *,	/* layout info for the event */
	MR_trace_port,
	int,			/* call sequence number */
	int,			/* call depth */
	const char *,		/* path to event goal within procedure */
	int);			/* highest numbered rN register in use */

/*
** These functions will report the number of the last event,
** if there have been some events, and will do nothing otherwise.
*/

extern	void	MR_trace_report(FILE *fp);
extern	void	MR_trace_report_raw(int fd);

/*
** MR_trace_init() is called from mercury_runtime_init()
** when the debuggee programs begins.
** MR_trace_end() is called from mercury_runtime_terminate()
** when the debuggee programs is exiting.
*/

extern	void	MR_trace_init(void);
extern	void	MR_trace_end(void);

typedef	enum {
	MR_TRACE_INTERNAL,
	MR_TRACE_EXTERNAL
} MR_trace_type;

extern	MR_trace_type	MR_trace_handler;
extern	bool		MR_trace_enabled;

extern	int		MR_trace_event_number;

#endif /* MERCURY_TRACE_H */
