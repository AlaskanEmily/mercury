#-----------------------------------------------------------------------------#

MGNUCFLAGS=-g
C2INITFLAGS=-w"`extract $(*:_init=) '' Entry`"

#-----------------------------------------------------------------------------#

# .PRECIOUS: %.mod %.c %.o %_init.c %.no %.nu %_init.nl %_init.no

%_init.c: Entry

%_init.nl: NP_Entry
	echo "main(_) :- `extract $* '' NP_Entry`." > $@

%.nux: %.nu %_init.no
	$(MNL) $(MNLFLAGS) -o $@ $($*.nos) $*_init.no

%.out: %
	{ [ -f $*.inp ] && cat $*.inp; } | ./$< > $@ 2>&1;

%.exp: %.nux
	{ [ -f $*.inp ] && cat $*.inp; } | ./$< > $@ 2>&1;

%.res: %.exp %.out
	-rm -f $@
	diff -u $*.exp $*.out > $@

clean: clean_out clean_exp clean_res clean_nl_init

clean_mc: clean_mod clean_c clean_o clean_out clean_res

clean_out:
	rm -f *.out

clean_exp:
	rm -f *.exp

clean_res:
	rm -f *.res

clean_nl_init:
	rm -f *_init.nl

realclean: clean_nux

clean_nux:
	rm -f *.nux

#-----------------------------------------------------------------------------#
