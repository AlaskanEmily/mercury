#-----------------------------------------------------------------------------#

main_target: check

#-----------------------------------------------------------------------------#

ERRORCHECKONLY_PROGS=	\
	det_infer_warning \
	double_underscore \
	duplicate_call \
	inf_recursion_lambda \
	infinite_recursion \
	inference_test \
	missing_if \
	pragma_source_file \
	simple_code \
	singleton_test \
	unused_args_test \
	unused_import

COMPILE_PROGS=			\
	arg_order_rearrangment

PROGS=$(ERRORCHECKONLY_PROGS) $(COMPILE_PROGS)

#-----------------------------------------------------------------------------#

# some files need to be compiled with special options

MCFLAGS-arg_order_rearrangment	= --introduce-accumulators
MCFLAGS-duplicate_call		= --warn-duplicate-calls
MCFLAGS-unused_args_test	= --warn-unused-args
MCFLAGS-unused_import		= --warn-interface-imports
MCFLAGS-inference_test		= --infer-all

#-----------------------------------------------------------------------------#

%.res:	%.exp %.err
	-rm -f $@
	diff -c $*.exp $*.err > $@

#-----------------------------------------------------------------------------#

DEPENDS=$(PROGS:%=%.depend)
ERRS=	$(ERRORCHECKONLY_PROGS:%=%.err)
CS=	$(COMPILE_PROGS:%=%.c)
RESS=	$(PROGS:%=%.res)

#-----------------------------------------------------------------------------#

depend:	$(DEPENDS)

check:	$(ERRS) $(CS) $(RESS)

all:	$(PROGS)

clean_local:	clean_err clean_res

clean_mc: clean_c clean_o clean_err clean_res

clean_err:
	rm -f *.err

clean_res:
	rm -f *.res

#-----------------------------------------------------------------------------#
