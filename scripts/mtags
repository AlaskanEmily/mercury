#!/usr/bin/perl

# create a vi style tags file for the Mercury programs named on the command line

die "Usage: mtags file1.nl ...\n" if $#ARGV < 0;

open(out, "| sort -u +0 -1 > tags");
while ($#ARGV >= 0)
{
	open(srcfile, $ARGV[0]);
	while ($_ = <srcfile>)
	{
		next if ($_ !~ /:- /);
		chop;

		($cmd, $decl, @rest) = split;
		$body = join(' ', @rest);
		if ($decl ne "pred" && $decl ne "type" && $decl ne "inst")
			{ next; }

		# printf "<%s> <%s>\n", $decl, $body;
		if ($body =~ m/\.$/ && $decl ne "pred")
			{ next; }

		$body =~ s/\.$//;
		$body =~ s/\(.*//;
		$body =~ s/ .*//;

		if ($body =~ m/[a-zA-Z_]/)
			{ printf out "%s\t%s\t/^%s\$/\n", $body, $ARGV[0], $_;}
	}

	close(cmdfile);
	shift(ARGV);
}
