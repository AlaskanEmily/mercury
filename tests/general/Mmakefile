#-----------------------------------------------------------------------------#

main_target: check

include ../Mmake.common

#-----------------------------------------------------------------------------#

ifeq ($(HAVE_NUPROLOG),yes)
%.exp: %.nu
	{ [ -f $*.inp ] && cat $*.inp; } | ./$< > $@ 2>&1;
endif

#-----------------------------------------------------------------------------#

# Any program added here should also be added to the `.cvsignore' file.

PROGS=		\
		arithmetic \
		array_test \
		commit_bug \
		commit_bug_2 \
		complex_failure \
		det_complicated_unify \
		determinism_inlining \
		disj_disj \
		double_error \
		double_error2 \
		duplicate_label \
		environment \
		fail_detism \
		float_test \
		frameopt_mkframe_bug \
		hello_again \
		higher_order \
		intermod_type \
		interpreter \
		liveness \
		liveness2 \
		mode_inf \
		mode_inf_bug \
		mu \
		nasty_nondet \
		nondet_disj \
		nondet_ite \
		nondet_ite_2 \
		nondet_ite_3 \
		nondet_ite_4 \
		nondetlive \
		parse_list \
		partition \
		petdr1 \
		prune_switch \
		semidet_lambda \
		semidet_map \
		set_test \
		string_format_test \
		string_test \
		string_test_2 \
		univ \
		unreachable 

# dnf.m does not work in non-gc grades, because it uses `pragma memo'
# (i.e. tabling) and tabling is not yet implemented for non-gc grades.
NOT_WORKING =	dnf

# mode_inf and mode_inf_bug need to be compiled with `--infer-all'.
MCFLAGS-mode_inf = --infer-all
MCFLAGS-mode_inf_bug = --infer-all
MCFLAGS-intermod_type = --intermodule-optimization
MCFLAGS-intermod_type2 = --intermodule-optimization

# In grade `none' with options `-O1 --opt-space' on kryten
# (a sparc-sun-solaris2.5 system), string_test needs to be linked
# with `--no-strip', otherwise it gets a seg fault. 
# The test case ../hard_coded/mode_choice suffers from a similar problem.
# This is probably a bug in one of the underlying tools (e.g. the Solaris
# linker) rather than a bug in Mercury, and since it is goes away when you
# compile with debugging information, it is very difficult to debug.
# It is much easier to just work around it this way rather than
# tracking it down.
MLFLAGS-string_test = --no-strip


DEPENDS=$(PROGS:%=%.depend)
OUTS=	$(PROGS:%=%.out)
EXPS=	$(PROGS:%=%.exp)
RESS=	$(PROGS:%=%.res)

depend: $(DEPENDS)

exp:	$(EXPS)

check:	$(OUTS) $(RESS)

all:	$(PROGS)

#-----------------------------------------------------------------------------#
