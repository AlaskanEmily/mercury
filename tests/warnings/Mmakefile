#-----------------------------------------------------------------------------#

main_target: check

#-----------------------------------------------------------------------------#

PROGS=	\
	double_underscore \
	duplicate_call \
	inf_recursion_lambda \
	infinite_recursion \
	missing_if \
	pragma_source_file \
	simple_code \
	singleton_test \
	unused_args_test \
	unused_import \
	uu_type

#-----------------------------------------------------------------------------#

# some files need to be compiled with special options

MCFLAGS-duplicate_call		= --warn-duplicate-calls
MCFLAGS-unused_args_test	= --warn-unused-args
MCFLAGS-unused_import		= --warn-interface-imports

#-----------------------------------------------------------------------------#

# the compilation of uu_type is expected to yield a non-zero exit status
uu_type.err:	uu_type.m
	-mmc --errorcheck-only uu_type.m > uu_type.err 2>&1

%.res:	%.exp %.err
	-rm -f $@
	diff -c $*.exp $*.err > $@

#-----------------------------------------------------------------------------#

DEPENDS=$(PROGS:%=%.depend)
ERRS=	$(PROGS:%=%.err)
RESS=	$(PROGS:%=%.res)

#-----------------------------------------------------------------------------#

depend:	$(DEPENDS)

check:	$(ERRS) $(RESS)

all:	$(PROGS)

clean:	clean_err clean_res

clean_mc: clean_c clean_o clean_err clean_res

clean_err:
	rm -f *.err

clean_res:
	rm -f *.res

#-----------------------------------------------------------------------------#
